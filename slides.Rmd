---
title: "`pagedown` course"
output:
  xaringan::moon_reader:
    css: ["style.css", "default"]
    lib_dir: libs
    df_print: paged
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
      ratio: 16:9
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE,
                      message = FALSE,
                      rows.print = 5)
```

```{r}
library(tidyverse)
```


class: inverse, center, middle

background-image:url("img/page.jpg")

# Introduction to pagedown

---

## The problem

We often want to get PDF from R :

--

+ it's portable

--

+ it's widely used in the business world

--

+ it allows parametrised reporting

---

## The problem


... And we sometimes use LaTeX for that task, but :

--

+ outputs are awful (outside from the scientific world)

```{r, out.height='250px', fig.align = 'left'}
knitr::include_graphics("https://i.stack.imgur.com/Nug7W.png", dpi = 300)
```

--

+ they are hard to customize

---

## The solution : `pagedown`

Principles :

--

+ it relies on PagedJs, a Javascript library

--

+ this one helps to "translate" some CSS style into a page

--

+ and you can print this page (using Chrome or another browser, in R : `pagedown::chrome_print`) to get a PDF

---

## Why `pagedown` ?

**It's a web-based tool**

--

So you can use tools like HTML, CSS or Javascript to style it :

--

+ way easier than LaTeX to learn

--

+ easier to reuse or share some parts with your website or other templates (like `xaringan` or `blogdown`)

--

+ outputs are nicer than with LaTeX

---

## Some examples

```{r, out.height='300px', fig.align='default', fig.show = "hold"}
knitr::include_graphics(
  c(
    "https://raw.githubusercontent.com/tvroylandt/sgdf_pagedown/master/img/page1.PNG",
    "https://p218.p3.n0.cdn.getcloudapp.com/items/4gumRNLp/Image%202020-03-22%20at%202.24.38%20PM.png",
    "https://mk0rfortheresto0o08q.kinstacdn.com/wp-content/uploads/2021/01/grid.gif"
  ),
  dpi = 300
)
```

---

## Some examples

```{r, fig.align='left', out.height='200px', out.width='400px'}
knitr::include_graphics("img/psc_housing_1.png", dpi = 300)
knitr::include_graphics("img/psc_housing_2.png", dpi = 300)
```

---
class: inverse, center, middle

background-image:url("img/anatomy.jpg")

# Anatomy of a document

---

## How `pagedown` works

--

**`pagedown`** is a R package which provide custom outputs formats :

--

+ you call it through `pagedown::html_paged` in the YAML header

--

+ and use the `css` argument to provide a custom style sheet

--

```{yaml, echo = TRUE, eval = FALSE}
---
title: "My title"
date: "May 2022"
output:
  pagedown::html_paged:
    css: "assets/main.css"
    number_sections: FALSE
knit: pagedown::chrome_print
---
```

--

+ **tip** : you can also wrap it inside a custom package and a custom function

---

## Behind the scene

--

1. `pagedown` + `rmarkdown` translate the document into a web page build with **HTML** (using Pandoc)

--

2. `pagedown` calls PagedJs :

  + which cuts the document into pages (like scissors)
  + put everything at the right place (like glue on papper) by looking at the `@page` statement in the **CSS**

--

3. We use `pagedown::chrome_print` to print the document to PDF using Chrome printing device

--

```{r, fig.align='left', out.height='300px', out.width='900px'}
knitr::include_graphics("img/pagedown_process.png", dpi = 300)
```

---
class: inverse, center, middle

background-image:url("img/markup.jpg")

# HTML : a markup tool

---

## HTML : a definition

HTML means HyperText Markup Language : 

--

+ You can see it as a building block of every Web Page, like a Lego brick.

--

+ A lot of bricks are available :

  + `<p>` for paragraphs
  + `<h1>`, `<h2>` and so on for titles
  + `<ul>` and `<li>` for lists
  + etc.
  
--

+ They are often nested
  
--

+ The user can define it's own bricks called "div" using `<div>` and `</div>` (to begin/close the block)

---

## How to get the HTML skeleton of a web page

You can show the HTML content of your document by opening it in Chrome and use the DevTools (Inspect). It shows you the differents divs.

```{r, out.height='400px'}
knitr::include_graphics("img/chrome_devtools.gif")
```

---

## How does it look like ?

```{r, out.height='500px'}
knitr::include_graphics("img/html_elements.gif")
```

---

## HTML as an R user

+ You don't write plain HTML, you write Markdown

--

+ Behind the scenes, `rmarkdown` calls Pandoc, which translate it into HTML--

--

+ You can define special divs using `:::name-of-the-div` to open it and `:::` to close it

--

+ See [the guide](https://www.markdownguide.org/basic-syntax/) for the translation between Markdown and HTML

---

## Common HTML elements

```{r tbl_html}
tibble(
  elem = c(
    "p",
    "h1",
    "h2",
    "h3",
    "ul",
    "li",
    "blockquote",
    "img",
    "toc",
    "body"
  ),
  meaning = c(
    "Paragraph",
    "Header 1",
    "Header 2",
    "Header 3",
    "List",
    "List element",
    "Blockquote",
    "Image",
    "Table of contents",
    "Body (everything)"
  )
) %>% 
  knitr::kable("html", col.names = c("Element", "Meaning"))
```

---

class: inverse, center, middle

background-image:url("img/drawing.jpg")

# CSS : draw the world

---

## CSS : a definition

CSS means Cascading Style Sheets :

--

+ it's used to describe how elements should look like

--

+ if HTML is the Lego brick, CSS is the description of it :

  + size
  + color
  + shape
  
--

```{r, fig.align='left', out.height='200px', out.width='600px'}
knitr::include_graphics("img/lego_html_css.png", dpi = 300)
```

---
## CSS properties

A CSS file is a list of properties for each HTML element :

```{css, eval = FALSE, echo = TRUE}
h1 {
  font-size: 36pt;
  color: #6caadd;
  margin-left: 0.2in;
}

h2 {
  font-size: 18pt;
  color: #6caadd;
  margin-left: 0.2in;
}

p, ul, li {
  font-size: 12pt;
  color: #404e6b;
  margin-left: 0.2in;
}

blockquote {
  border-left: 2px solid blue;
}
```

---
## In R

--

The main way to use CSS is to provide a link to a CSS file inside the `css` argument of your custom format :

```{r, fig.align='left', out.height='200px', out.width='600px'}
knitr::include_graphics("img/pagedown_help_css.png", dpi = 300)
```

--

It will replace the default style provided with the package.

--

The special divs made in RMarkdown could be access by `.name-of-the-div{}`

---

## Common CSS properties

```{r tbl_css1}
tibble(
  prop = c(
    "font-size",
    "font-family",
    "font-weight",
    "font-style",
    "color",
    "background-color",
    "background-image",
    "background-repeat",
    "line-height"
  ),
  meaning = c(
    "Font size (mostly in pt)",
    "Font family",
    "Font weight (normal, bold, or a weight from 100 to 900)",
    "Font style, like italic",
    "Color of the element",
    "Color of the background",
    "Url of the background image",
    "Always to no-repeat",
    "Line height"
  ),
  example = c(
    "font-size: 36pt;",
    "font-family: Inter;",
    "font-weight: bold;",
    "font-style: italic;",
    "color: #6caadd;",
    "background-color: #6caadd;",
    "background-image: url(img/my_img.jpg);",
    "background-repeat: no-repeat;",
    "line-height: 1;"
  )
) %>%
  knitr::kable("html", col.names = c("Element", "Meaning", "Example"))
```

---

## Common CSS properties

```{r tbl_css2}
tibble(
  prop = c(
    "margin-block-start",
    "margin-block-end",
    "content",
    "margin",
    "padding",
    "border"
  ),
  meaning = c(
    "Margin before the block",
    "Margin after the block",
    "Text content if needed",
    "Margin",
    "Padding (margins but less with less constraints)",
    "Border (if you want solid border)"
  ),
  example = c(
    "margin-block-start: 2px;",
    "margin-block-end: 2px;",
    "content: 'my content';",
    "margin : 1in;",
    "padding; 0.5in;",
    "border:2px solid #6caadd;"
  )
) %>%
  knitr::kable("html", col.names = c("Element", "Meaning", "Example"))
```

---

class: inverse, center, middle

background-image:url("img/beast.jpg")

# Inside of the beast

---

---

## In `pagedown`

You have special divs created by Pagedjs for each page + margins.
It's better to handle them in the CSS.

---

## How to organize CSS files

CSS modules
- Explain how pagedown docs talk about overwriting CSS files + why you do it differently

Vars
- vars.css

- get CSS vars from R
- margin size

---
## Fonts + text

Fonts
- fonts.css

Text
- body.css

Style every elements you need --> see CSS

---
## Graphical elements

Pictures (graphs)
- pictures.css
- img : 100%

Tables
- tables.css
- not always mandatory, depends if you use `flextable`, `gt` or another. You can also style it in R

---
## Layout

Margins + page breaks
- layout.css

whole page or margins

```{r, out.height='400px'}
knitr::include_graphics("https://pagedjs.org/images/margin-boxes.png")
```

CSS pseudo classes (e.g. page:first) + page blank
- layout.css
- named page to create your own

Page numbers
- layout.css
- content : counter(page) + reset on a special div if needed

Table of contents
- layout.css
- see the default toc content in the pagedown CSS

Footnotes/endnotes
- layout.css

Columns layout
- use two columns nested if needed  + change size (see before as an example)

---
## Front + back cover

Front cover
- title.css

+ two ways to handle newpage (newpage or page-break-before on a special div 
+ must nullify changes on the layout : use content none or background none
+ use position absolute if needed

Back cover
- last.css

 + Special div for last page


+ back and front cover in `pagedown` to change image dynamically

---

class: inverse, center, middle

background-image:url("img/mine.jpg")

# Resources

---

- https://pagedjs.org/documentation/ + gitlab
- pagedown github
- Mozilla
- W3C